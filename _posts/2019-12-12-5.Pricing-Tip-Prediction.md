---
title: "Pricing Tip Prediction for New Hosts in New York "
date: 2019-12-08T15:34:30-04:00
published: true
tags: [marching learning, model validation]
excerpt: "A marchine model was build to predict the Airbnb Price for new Airbnb hosts."
hv-loader:
  hv-chart-1: "charts/importance_bar.html"
toc: true
toc_sticky: true
---

In this part, we decided to build a machine learning model to help the new Airbnb hosts set their price. 

## Data Processing
The first step is handling outliers, we examined the price distribution, filtered the outliers, as well as removed the  NA value of potential features. The final dataset contains 26624 observations.    
   
![data](https://raw.githubusercontent.com/liziqun/MUSA620_Final_Project/master/assets/images/hist_price.png)
``` python
airbnb_gpd = airbnb_gpd [(np.log1p(airbnb_gpd ['price']) < 8) & (np.log1p(airbnb_gpd ['price']) >3)]
airbnb_gpd=airbnb_gpd.dropna()
len(airbnb_gpd)
```
> 26624   
  
To get a sense of the spatial distribution of Airbnb price in New York, we visualized the price of Airbnb by their locations.Besides,we also plot a price map by neighbourhood.
![price](https://raw.githubusercontent.com/liziqun/MUSA620_Final_Project/master/assets/images/combine.png)    

## Modeling
We selected several potential variables that might influence the price of Airbnband, and loaded the data from NY opendata and OSM, including the crime data, 311 requests data, university, subway and attractions. 
    
Below, we engineered the features and show the distance between Airbnb and the average distance to the 5 nearest crimes,3 nearest 311 calls for dirty condition,1 nearest 311 calls for noise, 3 nearest attractions, 1 nearest university and 1 nearest subway station.   
![feature](https://raw.githubusercontent.com/liziqun/MUSA620_Final_Project/master/assets/images/features.png)   

Also, a correlation matrix was created to examined the correlation between those variables.
![corr](https://raw.githubusercontent.com/liziqun/MUSA620_Final_Project/master/assets/images/corr.png)

The final selected variables are as follows:
```python


# Numerical columns
num_cols = [
     'accommodates',
     'bathrooms',
     'bedrooms',
     'guests_included',
     'beds',
     'review_scores_rating',
     'reviews_per_month',
     'logDistCrime',
     'logDistNoise',
     'logDistDirty',
     'logDistSubway',
     'logDistAttr',
     'logDistUni',
     'LaggedPrice'
]
# Categorical columns
cat_cols = [ 'host_identity_verified',
             'instant_bookable',
             'neighbourhood',
             'room_type',
             'cancellation_policy'
           ]

# Set up the column transformer with two transformers
# Scale the numerical columns and one-hot 
preprocessor = ColumnTransformer(
    transformers=[
        ("num", StandardScaler(), num_cols),
        ("cat", OneHotEncoder(handle_unknown="ignore"), cat_cols),
    ]
)

```


<div id="hv-chart-1"></div>

![validation](https://raw.githubusercontent.com/liziqun/MUSA620_Final_Project/master/assets/images/model_validation.png)
